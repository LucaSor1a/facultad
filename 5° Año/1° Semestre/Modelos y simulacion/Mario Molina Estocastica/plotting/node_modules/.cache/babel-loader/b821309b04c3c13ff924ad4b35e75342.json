{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar d3_shape_1 = require(\"d3-shape\");\n\nvar d3_selection_1 = require(\"d3-selection\");\n\nvar clamp_1 = __importDefault(require(\"clamp\"));\n\nvar utils_1 = __importDefault(require(\"./utils\"));\n\nvar globals_1 = __importDefault(require(\"./globals\"));\n\nvar eval_1 = require(\"./helpers/eval\");\n\nfunction mouseTip(config) {\n  config = Object.assign({\n    xLine: false,\n    yLine: false,\n    renderer: function renderer(x, y) {\n      return '(' + x.toFixed(3) + ', ' + y.toFixed(3) + ')';\n    },\n    owner: null\n  }, config);\n  var MARGIN = 20;\n  var line = d3_shape_1.line().x(function (d) {\n    return d[0];\n  }).y(function (d) {\n    return d[1];\n  });\n\n  function lineGenerator(el, data) {\n    return el.append('path').datum(data).attr('stroke', 'grey').attr('stroke-dasharray', '5,5').attr('opacity', 0.5).attr('d', line);\n  }\n\n  var tipInnerJoin, tipInnerEnter;\n\n  function tip(selection) {\n    var join = selection.selectAll('g.tip').data(function (d) {\n      return [d];\n    }); // enter\n\n    var tipEnter = join.enter().append('g').attr('class', 'tip').attr('clip-path', 'url(#function-plot-clip-' + config.owner.id + ')'); // enter + update = enter inner tip\n\n    tipInnerJoin = join.merge(tipEnter).selectAll('g.inner-tip').data(function (d) {\n      // debugger\n      return [d];\n    });\n    tipInnerEnter = tipInnerJoin.enter().append('g').attr('class', 'inner-tip').style('display', 'none').each(function () {\n      var el = d3_selection_1.select(this);\n      lineGenerator(el, [[0, -config.owner.meta.height - MARGIN], [0, config.owner.meta.height + MARGIN]]).attr('class', 'tip-x-line').style('display', 'none');\n      lineGenerator(el, [[-config.owner.meta.width - MARGIN, 0], [config.owner.meta.width + MARGIN, 0]]).attr('class', 'tip-y-line').style('display', 'none');\n      el.append('circle').attr('r', 3);\n      el.append('text').attr('transform', 'translate(5,-5)');\n    }); // enter + update\n\n    tipInnerJoin.merge(tipInnerEnter).selectAll('.tip-x-line').style('display', config.xLine ? null : 'none');\n    tipInnerJoin.merge(tipInnerEnter).selectAll('.tip-y-line').style('display', config.yLine ? null : 'none');\n  }\n\n  tip.move = function (coordinates) {\n    var i;\n    var minDist = Infinity;\n    var closestIndex = -1;\n    var x, y;\n    var selection = tipInnerJoin.merge(tipInnerEnter);\n    var inf = 1e8;\n    var meta = config.owner.meta;\n    var data = selection.datum().data;\n    var xScale = meta.xScale;\n    var yScale = meta.yScale;\n    var width = meta.width;\n    var height = meta.height;\n    var x0 = coordinates.x;\n    var y0 = coordinates.y;\n\n    for (i = 0; i < data.length; i += 1) {\n      // skipTip=true skips the evaluation in the datum\n      // implicit equations cannot be evaluated with a single point\n      // parametric equations cannot be evaluated with a single point\n      // polar equations cannot be evaluated with a single point\n      if (data[i].skipTip || data[i].fnType !== 'linear') {\n        continue;\n      }\n\n      var range = data[i].range || [-inf, inf];\n      var candidateY = void 0;\n\n      if (x0 > range[0] - globals_1.default.TIP_X_EPS && x0 < range[1] + globals_1.default.TIP_X_EPS) {\n        try {\n          candidateY = eval_1.builtIn(data[i], 'fn', {\n            x: x0\n          });\n        } catch (e) {}\n\n        if (utils_1.default.isValidNumber(candidateY)) {\n          var tDist = Math.abs(candidateY - y0);\n\n          if (tDist < minDist) {\n            minDist = tDist;\n            closestIndex = i;\n          }\n        }\n      }\n    }\n\n    if (closestIndex !== -1) {\n      x = x0;\n\n      if (data[closestIndex].range) {\n        x = Math.max(x, data[closestIndex].range[0]);\n        x = Math.min(x, data[closestIndex].range[1]);\n      }\n\n      y = eval_1.builtIn(data[closestIndex], 'fn', {\n        x: x\n      });\n      tip.show();\n      config.owner.emit('tip:update', {\n        x: x,\n        y: y,\n        index: closestIndex\n      }); // @ts-ignore\n\n      var clampX = clamp_1.default(x, xScale.invert(-MARGIN), xScale.invert(width + MARGIN)); // @ts-ignore\n\n      var clampY = clamp_1.default(y, yScale.invert(height + MARGIN), yScale.invert(-MARGIN));\n      var color = utils_1.default.color(data[closestIndex], closestIndex);\n      selection.style('color', 'red');\n      selection.attr('transform', 'translate(' + xScale(clampX) + ',' + yScale(clampY) + ')');\n      selection.select('circle').attr('fill', color);\n      selection.select('text').attr('fill', color).text(config.renderer(x, y, closestIndex));\n    } else {\n      tip.hide();\n    }\n  };\n\n  tip.show = function () {\n    tipInnerJoin.merge(tipInnerEnter).style('display', null);\n  };\n\n  tip.hide = function () {\n    tipInnerJoin.merge(tipInnerEnter).style('display', 'none');\n  }; // generations of getters/setters\n\n\n  Object.keys(config).forEach(function (option) {\n    utils_1.default.getterSetter.call(tip, config, option);\n  });\n  return tip;\n}\n\nexports.default = mouseTip;","map":{"version":3,"mappings":"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","names":["mouseTip","config","Object","assign","xLine","yLine","renderer","x","y","toFixed","owner","MARGIN","line","d3_shape_1","d","lineGenerator","el","data","append","datum","attr","tipInnerJoin","tipInnerEnter","tip","selection","join","selectAll","tipEnter","enter","id","merge","style","each","d3_selection_1","meta","height","width","move","coordinates","i","minDist","Infinity","closestIndex","inf","xScale","yScale","x0","y0","length","skipTip","fnType","range","candidateY","globals_1","TIP_X_EPS","eval_1","e","utils_1","isValidNumber","tDist","Math","abs","max","min","show","emit","index","clampX","clamp_1","invert","clampY","color","select","text","hide","keys","forEach","option","getterSetter","call","exports"],"sourceRoot":"","sources":["../src/tip.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}