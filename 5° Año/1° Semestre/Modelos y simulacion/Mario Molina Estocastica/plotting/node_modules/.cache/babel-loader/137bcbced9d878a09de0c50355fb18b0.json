{"ast":null,"code":"var tokenType = require('./token-type');\n\nvar Lexer = require('./Lexer');\n\nvar ConstantNode = require('./node/ConstantNode');\n\nvar OperatorNode = require('./node/OperatorNode');\n\nvar UnaryNode = require('./node/UnaryNode');\n\nvar SymbolNode = require('./node/SymbolNode');\n\nvar FunctionNode = require('./node/FunctionNode');\n\nvar ArrayNode = require('./node/ArrayNode');\n\nvar ConditionalNode = require('./node/ConditionalNode');\n\nvar AssignmentNode = require('./node/AssignmentNode');\n\nvar BlockNode = require('./node/BlockNode');\n/**\n * Grammar DSL:\n *\n * program          : block (; block)*\n *\n * block            : assignment\n *\n * assignment       : ternary\n *                  | symbol `=` assignment\n *\n * ternary          : logicalOR\n *                  | logicalOR `?` ternary `:` ternary\n *\n * logicalOR        : logicalXOR\n *                  | logicalXOR (`||`,`or`) logicalOR\n *\n * logicalXOR       : logicalAND\n *                  : logicalAND `xor` logicalXOR\n *\n * logicalAND       : bitwiseOR\n *                  | bitwiseOR (`&&`,`and`) logicalAND\n *\n * bitwiseOR        : bitwiseXOR\n *                  | bitwiseXOR `|` bitwiseOR\n *\n * bitwiseXOR       : bitwiseAND\n *                  | bitwiseAND `^|` bitwiseXOR\n *\n * bitwiseAND       : relational\n *                  | relational `&` bitwiseAND\n *\n * relational       : shift\n *                  | shift (`!=` | `==` | `>` | '<' | '<=' |'>=') shift)\n *\n * shift            : additive\n *                  | additive (`>>` | `<<` | `>>>`) shift\n *\n * additive         : multiplicative\n *                  | multiplicative (`+` | `-`) additive\n *\n * multiplicative   : unary\n *                  | unary (`*` | `/` | `%`) unary\n *                  | unary symbol\n *\n * unary            : pow\n *                  | (`-` | `+` | `~`) unary\n *\n * pow              : factorial\n *                  | factorial (`^`, '**') unary\n *\n * factorial        : symbol\n *                  | symbol (`!`)\n *\n * symbol           : symbolToken\n *                  | symbolToken functionCall\n *                  | string\n *\n * functionCall     : `(` `)`\n *                  | `(` ternary (, ternary)* `)`\n *\n * string           : `'` (character)* `'`\n *                  : `\"` (character)* `\"`\n *                  | array\n *\n * array            : `[` `]`\n *                  | `[` assignment (, assignment)* `]`\n *                  | number\n *\n * number           : number-token\n *                  | parentheses\n *\n * parentheses      : `(` assignment `)`\n *                  : end\n *\n * end              : NULL\n *\n * @param {[type]} lexer [description]\n */\n\n\nfunction Parser() {\n  this.lexer = new Lexer();\n  this.tokens = null;\n}\n\nParser.prototype.current = function () {\n  return this.tokens[0];\n};\n\nParser.prototype.next = function () {\n  return this.tokens[1];\n};\n\nParser.prototype.peek = function () {\n  if (this.tokens.length) {\n    var first = this.tokens[0];\n\n    for (var i = 0; i < arguments.length; i += 1) {\n      if (first.value === arguments[i]) {\n        return true;\n      }\n    }\n  }\n};\n\nParser.prototype.consume = function (e) {\n  return this.tokens.shift();\n};\n\nParser.prototype.expect = function (e) {\n  if (!this.peek(e)) {\n    throw Error('expected ' + e);\n  }\n\n  return this.consume();\n};\n\nParser.prototype.isEOF = function () {\n  return this.current().type === tokenType.EOF;\n};\n\nParser.prototype.parse = function (text) {\n  this.tokens = this.lexer.lex(text);\n  return this.program();\n};\n\nParser.prototype.program = function () {\n  var blocks = [];\n\n  while (!this.isEOF()) {\n    blocks.push(this.assignment());\n\n    if (this.peek(';')) {\n      this.consume();\n    }\n  }\n\n  this.end();\n  return new BlockNode(blocks);\n};\n\nParser.prototype.assignment = function () {\n  var left = this.ternary();\n\n  if (left instanceof SymbolNode && this.peek('=')) {\n    this.consume();\n    return new AssignmentNode(left.name, this.assignment());\n  }\n\n  return left;\n};\n\nParser.prototype.ternary = function () {\n  var predicate = this.logicalOR();\n\n  if (this.peek('?')) {\n    this.consume();\n    var truthy = this.ternary();\n    this.expect(':');\n    var falsy = this.ternary();\n    return new ConditionalNode(predicate, truthy, falsy);\n  }\n\n  return predicate;\n};\n\nParser.prototype.logicalOR = function () {\n  var left = this.logicalXOR();\n\n  if (this.peek('||')) {\n    var op = this.consume();\n    var right = this.logicalOR();\n    return new OperatorNode(op.value, [left, right]);\n  }\n\n  return left;\n};\n\nParser.prototype.logicalXOR = function () {\n  var left = this.logicalAND();\n\n  if (this.current().value === 'xor') {\n    var op = this.consume();\n    var right = this.logicalXOR();\n    return new OperatorNode(op.value, [left, right]);\n  }\n\n  return left;\n};\n\nParser.prototype.logicalAND = function () {\n  var left = this.bitwiseOR();\n\n  if (this.peek('&&')) {\n    var op = this.consume();\n    var right = this.logicalAND();\n    return new OperatorNode(op.value, [left, right]);\n  }\n\n  return left;\n};\n\nParser.prototype.bitwiseOR = function () {\n  var left = this.bitwiseXOR();\n\n  if (this.peek('|')) {\n    var op = this.consume();\n    var right = this.bitwiseOR();\n    return new OperatorNode(op.value, [left, right]);\n  }\n\n  return left;\n};\n\nParser.prototype.bitwiseXOR = function () {\n  var left = this.bitwiseAND();\n\n  if (this.peek('^|')) {\n    var op = this.consume();\n    var right = this.bitwiseXOR();\n    return new OperatorNode(op.value, [left, right]);\n  }\n\n  return left;\n};\n\nParser.prototype.bitwiseAND = function () {\n  var left = this.relational();\n\n  if (this.peek('&')) {\n    var op = this.consume();\n    var right = this.bitwiseAND();\n    return new OperatorNode(op.value, [left, right]);\n  }\n\n  return left;\n};\n\nParser.prototype.relational = function () {\n  var left = this.shift();\n\n  if (this.peek('==', '===', '!=', '!==', '>=', '<=', '>', '<')) {\n    var op = this.consume();\n    var right = this.shift();\n    return new OperatorNode(op.value, [left, right]);\n  }\n\n  return left;\n};\n\nParser.prototype.shift = function () {\n  var left = this.additive();\n\n  if (this.peek('>>', '<<', '>>>')) {\n    var op = this.consume();\n    var right = this.shift();\n    return new OperatorNode(op.value, [left, right]);\n  }\n\n  return left;\n};\n\nParser.prototype.additive = function () {\n  var left = this.multiplicative();\n\n  while (this.peek('+', '-')) {\n    var op = this.consume();\n    left = new OperatorNode(op.value, [left, this.multiplicative()]);\n  }\n\n  return left;\n};\n\nParser.prototype.multiplicative = function () {\n  var op, right;\n  var left = this.unary();\n\n  while (this.peek('*', '/', '%')) {\n    op = this.consume();\n    left = new OperatorNode(op.value, [left, this.unary()]);\n  } // implicit multiplication\n  // - 2 x\n  // - 2(x)\n  // - (2)2\n\n\n  if (this.current().type === tokenType.SYMBOL || this.peek('(') || !(left.type instanceof ConstantNode) && this.current().type === tokenType.NUMBER) {\n    right = this.multiplicative();\n    return new OperatorNode('*', [left, right]);\n  }\n\n  return left;\n};\n\nParser.prototype.unary = function () {\n  if (this.peek('-', '+', '~')) {\n    var op = this.consume();\n    var right = this.unary();\n    return new UnaryNode(op.value, right);\n  }\n\n  return this.pow();\n};\n\nParser.prototype.pow = function () {\n  var left = this.factorial();\n\n  if (this.peek('^', '**')) {\n    var op = this.consume();\n    var right = this.unary();\n    return new OperatorNode(op.value, [left, right]);\n  }\n\n  return left;\n};\n\nParser.prototype.factorial = function () {\n  var left = this.symbol();\n\n  if (this.peek('!')) {\n    var op = this.consume();\n    return new OperatorNode(op.value, [left]);\n  }\n\n  return left;\n};\n\nParser.prototype.symbol = function () {\n  var current = this.current();\n\n  if (current.type === tokenType.SYMBOL) {\n    var symbol = this.consume();\n    var node = this.functionCall(symbol);\n    return node;\n  }\n\n  return this.string();\n};\n\nParser.prototype.functionCall = function (symbolToken) {\n  var name = symbolToken.value;\n\n  if (this.peek('(')) {\n    this.consume();\n    var params = [];\n\n    while (!this.peek(')') && !this.isEOF()) {\n      params.push(this.assignment());\n\n      if (this.peek(',')) {\n        this.consume();\n      }\n    }\n\n    this.expect(')');\n    return new FunctionNode(name, params);\n  }\n\n  return new SymbolNode(name);\n};\n\nParser.prototype.string = function () {\n  if (this.current().type === tokenType.STRING) {\n    return new ConstantNode(this.consume().value, 'string');\n  }\n\n  return this.array();\n};\n\nParser.prototype.array = function () {\n  if (this.peek('[')) {\n    this.consume();\n    var params = [];\n\n    while (!this.peek(']') && !this.isEOF()) {\n      params.push(this.assignment());\n\n      if (this.peek(',')) {\n        this.consume();\n      }\n    }\n\n    this.expect(']');\n    return new ArrayNode(params);\n  }\n\n  return this.number();\n};\n\nParser.prototype.number = function () {\n  var token = this.current();\n\n  if (token.type === tokenType.NUMBER) {\n    return new ConstantNode(this.consume().value, 'number');\n  }\n\n  return this.parentheses();\n};\n\nParser.prototype.parentheses = function () {\n  var token = this.current();\n\n  if (token.value === '(') {\n    this.consume();\n    var left = this.assignment();\n    this.expect(')');\n    return left;\n  }\n\n  return this.end();\n};\n\nParser.prototype.end = function () {\n  var token = this.current();\n\n  if (token.type !== tokenType.EOF) {\n    throw Error('unexpected end of expression');\n  }\n};\n\nmodule.exports = Parser;","map":{"version":3,"sources":["/mnt/sda3/Lucas/Documents/facultad/5° Año/1° Semestre/Modelos y simulaciones/Mario Molina Estocastica/plotting/node_modules/mr-parser/lib/Parser.js"],"names":["tokenType","require","Lexer","ConstantNode","OperatorNode","UnaryNode","SymbolNode","FunctionNode","ArrayNode","ConditionalNode","AssignmentNode","BlockNode","Parser","lexer","tokens","prototype","current","next","peek","length","first","i","arguments","value","consume","e","shift","expect","Error","isEOF","type","EOF","parse","text","lex","program","blocks","push","assignment","end","left","ternary","name","predicate","logicalOR","truthy","falsy","logicalXOR","op","right","logicalAND","bitwiseOR","bitwiseXOR","bitwiseAND","relational","additive","multiplicative","unary","SYMBOL","NUMBER","pow","factorial","symbol","node","functionCall","string","symbolToken","params","STRING","array","number","token","parentheses","module","exports"],"mappings":"AAAA,IAAIA,SAAS,GAAGC,OAAO,CAAC,cAAD,CAAvB;;AAEA,IAAIC,KAAK,GAAGD,OAAO,CAAC,SAAD,CAAnB;;AACA,IAAIE,YAAY,GAAGF,OAAO,CAAC,qBAAD,CAA1B;;AACA,IAAIG,YAAY,GAAGH,OAAO,CAAC,qBAAD,CAA1B;;AACA,IAAII,SAAS,GAAGJ,OAAO,CAAC,kBAAD,CAAvB;;AACA,IAAIK,UAAU,GAAGL,OAAO,CAAC,mBAAD,CAAxB;;AACA,IAAIM,YAAY,GAAGN,OAAO,CAAC,qBAAD,CAA1B;;AACA,IAAIO,SAAS,GAAGP,OAAO,CAAC,kBAAD,CAAvB;;AACA,IAAIQ,eAAe,GAAGR,OAAO,CAAC,wBAAD,CAA7B;;AACA,IAAIS,cAAc,GAAGT,OAAO,CAAC,uBAAD,CAA5B;;AACA,IAAIU,SAAS,GAAGV,OAAO,CAAC,kBAAD,CAAvB;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASW,MAAT,GAAmB;AACjB,OAAKC,KAAL,GAAa,IAAIX,KAAJ,EAAb;AACA,OAAKY,MAAL,GAAc,IAAd;AACD;;AAEDF,MAAM,CAACG,SAAP,CAAiBC,OAAjB,GAA2B,YAAY;AACrC,SAAO,KAAKF,MAAL,CAAY,CAAZ,CAAP;AACD,CAFD;;AAIAF,MAAM,CAACG,SAAP,CAAiBE,IAAjB,GAAwB,YAAY;AAClC,SAAO,KAAKH,MAAL,CAAY,CAAZ,CAAP;AACD,CAFD;;AAIAF,MAAM,CAACG,SAAP,CAAiBG,IAAjB,GAAwB,YAAY;AAClC,MAAI,KAAKJ,MAAL,CAAYK,MAAhB,EAAwB;AACtB,QAAIC,KAAK,GAAG,KAAKN,MAAL,CAAY,CAAZ,CAAZ;;AACA,SAAK,IAAIO,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGC,SAAS,CAACH,MAA9B,EAAsCE,CAAC,IAAI,CAA3C,EAA8C;AAC5C,UAAID,KAAK,CAACG,KAAN,KAAgBD,SAAS,CAACD,CAAD,CAA7B,EAAkC;AAChC,eAAO,IAAP;AACD;AACF;AACF;AACF,CATD;;AAWAT,MAAM,CAACG,SAAP,CAAiBS,OAAjB,GAA2B,UAAUC,CAAV,EAAa;AACtC,SAAO,KAAKX,MAAL,CAAYY,KAAZ,EAAP;AACD,CAFD;;AAIAd,MAAM,CAACG,SAAP,CAAiBY,MAAjB,GAA0B,UAAUF,CAAV,EAAa;AACrC,MAAI,CAAC,KAAKP,IAAL,CAAUO,CAAV,CAAL,EAAmB;AACjB,UAAMG,KAAK,CAAC,cAAcH,CAAf,CAAX;AACD;;AACD,SAAO,KAAKD,OAAL,EAAP;AACD,CALD;;AAOAZ,MAAM,CAACG,SAAP,CAAiBc,KAAjB,GAAyB,YAAY;AACnC,SAAO,KAAKb,OAAL,GAAec,IAAf,KAAwB9B,SAAS,CAAC+B,GAAzC;AACD,CAFD;;AAIAnB,MAAM,CAACG,SAAP,CAAiBiB,KAAjB,GAAyB,UAAUC,IAAV,EAAgB;AACvC,OAAKnB,MAAL,GAAc,KAAKD,KAAL,CAAWqB,GAAX,CAAeD,IAAf,CAAd;AACA,SAAO,KAAKE,OAAL,EAAP;AACD,CAHD;;AAKAvB,MAAM,CAACG,SAAP,CAAiBoB,OAAjB,GAA2B,YAAY;AACrC,MAAIC,MAAM,GAAG,EAAb;;AACA,SAAO,CAAC,KAAKP,KAAL,EAAR,EAAsB;AACpBO,IAAAA,MAAM,CAACC,IAAP,CAAY,KAAKC,UAAL,EAAZ;;AACA,QAAI,KAAKpB,IAAL,CAAU,GAAV,CAAJ,EAAoB;AAClB,WAAKM,OAAL;AACD;AACF;;AACD,OAAKe,GAAL;AACA,SAAO,IAAI5B,SAAJ,CAAcyB,MAAd,CAAP;AACD,CAVD;;AAYAxB,MAAM,CAACG,SAAP,CAAiBuB,UAAjB,GAA8B,YAAY;AACxC,MAAIE,IAAI,GAAG,KAAKC,OAAL,EAAX;;AACA,MAAID,IAAI,YAAYlC,UAAhB,IAA8B,KAAKY,IAAL,CAAU,GAAV,CAAlC,EAAkD;AAChD,SAAKM,OAAL;AACA,WAAO,IAAId,cAAJ,CAAmB8B,IAAI,CAACE,IAAxB,EAA8B,KAAKJ,UAAL,EAA9B,CAAP;AACD;;AACD,SAAOE,IAAP;AACD,CAPD;;AASA5B,MAAM,CAACG,SAAP,CAAiB0B,OAAjB,GAA2B,YAAY;AACrC,MAAIE,SAAS,GAAG,KAAKC,SAAL,EAAhB;;AACA,MAAI,KAAK1B,IAAL,CAAU,GAAV,CAAJ,EAAoB;AAClB,SAAKM,OAAL;AACA,QAAIqB,MAAM,GAAG,KAAKJ,OAAL,EAAb;AACA,SAAKd,MAAL,CAAY,GAAZ;AACA,QAAImB,KAAK,GAAG,KAAKL,OAAL,EAAZ;AACA,WAAO,IAAIhC,eAAJ,CAAoBkC,SAApB,EAA+BE,MAA/B,EAAuCC,KAAvC,CAAP;AACD;;AACD,SAAOH,SAAP;AACD,CAVD;;AAYA/B,MAAM,CAACG,SAAP,CAAiB6B,SAAjB,GAA6B,YAAY;AACvC,MAAIJ,IAAI,GAAG,KAAKO,UAAL,EAAX;;AACA,MAAI,KAAK7B,IAAL,CAAU,IAAV,CAAJ,EAAqB;AACnB,QAAI8B,EAAE,GAAG,KAAKxB,OAAL,EAAT;AACA,QAAIyB,KAAK,GAAG,KAAKL,SAAL,EAAZ;AACA,WAAO,IAAIxC,YAAJ,CAAiB4C,EAAE,CAACzB,KAApB,EAA2B,CAACiB,IAAD,EAAOS,KAAP,CAA3B,CAAP;AACD;;AACD,SAAOT,IAAP;AACD,CARD;;AAUA5B,MAAM,CAACG,SAAP,CAAiBgC,UAAjB,GAA8B,YAAY;AACxC,MAAIP,IAAI,GAAG,KAAKU,UAAL,EAAX;;AACA,MAAI,KAAKlC,OAAL,GAAeO,KAAf,KAAyB,KAA7B,EAAoC;AAClC,QAAIyB,EAAE,GAAG,KAAKxB,OAAL,EAAT;AACA,QAAIyB,KAAK,GAAG,KAAKF,UAAL,EAAZ;AACA,WAAO,IAAI3C,YAAJ,CAAiB4C,EAAE,CAACzB,KAApB,EAA2B,CAACiB,IAAD,EAAOS,KAAP,CAA3B,CAAP;AACD;;AACD,SAAOT,IAAP;AACD,CARD;;AAUA5B,MAAM,CAACG,SAAP,CAAiBmC,UAAjB,GAA8B,YAAY;AACxC,MAAIV,IAAI,GAAG,KAAKW,SAAL,EAAX;;AACA,MAAI,KAAKjC,IAAL,CAAU,IAAV,CAAJ,EAAqB;AACnB,QAAI8B,EAAE,GAAG,KAAKxB,OAAL,EAAT;AACA,QAAIyB,KAAK,GAAG,KAAKC,UAAL,EAAZ;AACA,WAAO,IAAI9C,YAAJ,CAAiB4C,EAAE,CAACzB,KAApB,EAA2B,CAACiB,IAAD,EAAOS,KAAP,CAA3B,CAAP;AACD;;AACD,SAAOT,IAAP;AACD,CARD;;AAUA5B,MAAM,CAACG,SAAP,CAAiBoC,SAAjB,GAA6B,YAAY;AACvC,MAAIX,IAAI,GAAG,KAAKY,UAAL,EAAX;;AACA,MAAI,KAAKlC,IAAL,CAAU,GAAV,CAAJ,EAAoB;AAClB,QAAI8B,EAAE,GAAG,KAAKxB,OAAL,EAAT;AACA,QAAIyB,KAAK,GAAG,KAAKE,SAAL,EAAZ;AACA,WAAO,IAAI/C,YAAJ,CAAiB4C,EAAE,CAACzB,KAApB,EAA2B,CAACiB,IAAD,EAAOS,KAAP,CAA3B,CAAP;AACD;;AACD,SAAOT,IAAP;AACD,CARD;;AAUA5B,MAAM,CAACG,SAAP,CAAiBqC,UAAjB,GAA8B,YAAY;AACxC,MAAIZ,IAAI,GAAG,KAAKa,UAAL,EAAX;;AACA,MAAI,KAAKnC,IAAL,CAAU,IAAV,CAAJ,EAAqB;AACnB,QAAI8B,EAAE,GAAG,KAAKxB,OAAL,EAAT;AACA,QAAIyB,KAAK,GAAG,KAAKG,UAAL,EAAZ;AACA,WAAO,IAAIhD,YAAJ,CAAiB4C,EAAE,CAACzB,KAApB,EAA2B,CAACiB,IAAD,EAAOS,KAAP,CAA3B,CAAP;AACD;;AACD,SAAOT,IAAP;AACD,CARD;;AAUA5B,MAAM,CAACG,SAAP,CAAiBsC,UAAjB,GAA8B,YAAY;AACxC,MAAIb,IAAI,GAAG,KAAKc,UAAL,EAAX;;AACA,MAAI,KAAKpC,IAAL,CAAU,GAAV,CAAJ,EAAoB;AAClB,QAAI8B,EAAE,GAAG,KAAKxB,OAAL,EAAT;AACA,QAAIyB,KAAK,GAAG,KAAKI,UAAL,EAAZ;AACA,WAAO,IAAIjD,YAAJ,CAAiB4C,EAAE,CAACzB,KAApB,EAA2B,CAACiB,IAAD,EAAOS,KAAP,CAA3B,CAAP;AACD;;AACD,SAAOT,IAAP;AACD,CARD;;AAUA5B,MAAM,CAACG,SAAP,CAAiBuC,UAAjB,GAA8B,YAAY;AACxC,MAAId,IAAI,GAAG,KAAKd,KAAL,EAAX;;AACA,MAAI,KAAKR,IAAL,CAAU,IAAV,EAAgB,KAAhB,EAAuB,IAAvB,EAA6B,KAA7B,EAAoC,IAApC,EAA0C,IAA1C,EAAgD,GAAhD,EAAqD,GAArD,CAAJ,EAA+D;AAC7D,QAAI8B,EAAE,GAAG,KAAKxB,OAAL,EAAT;AACA,QAAIyB,KAAK,GAAG,KAAKvB,KAAL,EAAZ;AACA,WAAO,IAAItB,YAAJ,CAAiB4C,EAAE,CAACzB,KAApB,EAA2B,CAACiB,IAAD,EAAOS,KAAP,CAA3B,CAAP;AACD;;AACD,SAAOT,IAAP;AACD,CARD;;AAUA5B,MAAM,CAACG,SAAP,CAAiBW,KAAjB,GAAyB,YAAY;AACnC,MAAIc,IAAI,GAAG,KAAKe,QAAL,EAAX;;AACA,MAAI,KAAKrC,IAAL,CAAU,IAAV,EAAgB,IAAhB,EAAsB,KAAtB,CAAJ,EAAkC;AAChC,QAAI8B,EAAE,GAAG,KAAKxB,OAAL,EAAT;AACA,QAAIyB,KAAK,GAAG,KAAKvB,KAAL,EAAZ;AACA,WAAO,IAAItB,YAAJ,CAAiB4C,EAAE,CAACzB,KAApB,EAA2B,CAACiB,IAAD,EAAOS,KAAP,CAA3B,CAAP;AACD;;AACD,SAAOT,IAAP;AACD,CARD;;AAUA5B,MAAM,CAACG,SAAP,CAAiBwC,QAAjB,GAA4B,YAAY;AACtC,MAAIf,IAAI,GAAG,KAAKgB,cAAL,EAAX;;AACA,SAAO,KAAKtC,IAAL,CAAU,GAAV,EAAe,GAAf,CAAP,EAA4B;AAC1B,QAAI8B,EAAE,GAAG,KAAKxB,OAAL,EAAT;AACAgB,IAAAA,IAAI,GAAG,IAAIpC,YAAJ,CAAiB4C,EAAE,CAACzB,KAApB,EAA2B,CAACiB,IAAD,EAAO,KAAKgB,cAAL,EAAP,CAA3B,CAAP;AACD;;AACD,SAAOhB,IAAP;AACD,CAPD;;AASA5B,MAAM,CAACG,SAAP,CAAiByC,cAAjB,GAAkC,YAAY;AAC5C,MAAIR,EAAJ,EAAQC,KAAR;AACA,MAAIT,IAAI,GAAG,KAAKiB,KAAL,EAAX;;AACA,SAAO,KAAKvC,IAAL,CAAU,GAAV,EAAe,GAAf,EAAoB,GAApB,CAAP,EAAiC;AAC/B8B,IAAAA,EAAE,GAAG,KAAKxB,OAAL,EAAL;AACAgB,IAAAA,IAAI,GAAG,IAAIpC,YAAJ,CAAiB4C,EAAE,CAACzB,KAApB,EAA2B,CAACiB,IAAD,EAAO,KAAKiB,KAAL,EAAP,CAA3B,CAAP;AACD,GAN2C,CAQ5C;AACA;AACA;AACA;;;AACA,MAAI,KAAKzC,OAAL,GAAec,IAAf,KAAwB9B,SAAS,CAAC0D,MAAlC,IACA,KAAKxC,IAAL,CAAU,GAAV,CADA,IAEC,EAAEsB,IAAI,CAACV,IAAL,YAAqB3B,YAAvB,KAAwC,KAAKa,OAAL,GAAec,IAAf,KAAwB9B,SAAS,CAAC2D,MAF/E,EAGM;AACJV,IAAAA,KAAK,GAAG,KAAKO,cAAL,EAAR;AACA,WAAO,IAAIpD,YAAJ,CAAiB,GAAjB,EAAsB,CAACoC,IAAD,EAAOS,KAAP,CAAtB,CAAP;AACD;;AAED,SAAOT,IAAP;AACD,CArBD;;AAuBA5B,MAAM,CAACG,SAAP,CAAiB0C,KAAjB,GAAyB,YAAY;AACnC,MAAI,KAAKvC,IAAL,CAAU,GAAV,EAAe,GAAf,EAAoB,GAApB,CAAJ,EAA8B;AAC5B,QAAI8B,EAAE,GAAG,KAAKxB,OAAL,EAAT;AACA,QAAIyB,KAAK,GAAG,KAAKQ,KAAL,EAAZ;AACA,WAAO,IAAIpD,SAAJ,CAAc2C,EAAE,CAACzB,KAAjB,EAAwB0B,KAAxB,CAAP;AACD;;AACD,SAAO,KAAKW,GAAL,EAAP;AACD,CAPD;;AASAhD,MAAM,CAACG,SAAP,CAAiB6C,GAAjB,GAAuB,YAAY;AACjC,MAAIpB,IAAI,GAAG,KAAKqB,SAAL,EAAX;;AACA,MAAI,KAAK3C,IAAL,CAAU,GAAV,EAAe,IAAf,CAAJ,EAA0B;AACxB,QAAI8B,EAAE,GAAG,KAAKxB,OAAL,EAAT;AACA,QAAIyB,KAAK,GAAG,KAAKQ,KAAL,EAAZ;AACA,WAAO,IAAIrD,YAAJ,CAAiB4C,EAAE,CAACzB,KAApB,EAA2B,CAACiB,IAAD,EAAOS,KAAP,CAA3B,CAAP;AACD;;AACD,SAAOT,IAAP;AACD,CARD;;AAUA5B,MAAM,CAACG,SAAP,CAAiB8C,SAAjB,GAA6B,YAAY;AACvC,MAAIrB,IAAI,GAAG,KAAKsB,MAAL,EAAX;;AACA,MAAI,KAAK5C,IAAL,CAAU,GAAV,CAAJ,EAAoB;AAClB,QAAI8B,EAAE,GAAG,KAAKxB,OAAL,EAAT;AACA,WAAO,IAAIpB,YAAJ,CAAiB4C,EAAE,CAACzB,KAApB,EAA2B,CAACiB,IAAD,CAA3B,CAAP;AACD;;AACD,SAAOA,IAAP;AACD,CAPD;;AASA5B,MAAM,CAACG,SAAP,CAAiB+C,MAAjB,GAA0B,YAAY;AACpC,MAAI9C,OAAO,GAAG,KAAKA,OAAL,EAAd;;AACA,MAAIA,OAAO,CAACc,IAAR,KAAiB9B,SAAS,CAAC0D,MAA/B,EAAuC;AACrC,QAAII,MAAM,GAAG,KAAKtC,OAAL,EAAb;AACA,QAAIuC,IAAI,GAAG,KAAKC,YAAL,CAAkBF,MAAlB,CAAX;AACA,WAAOC,IAAP;AACD;;AACD,SAAO,KAAKE,MAAL,EAAP;AACD,CARD;;AAUArD,MAAM,CAACG,SAAP,CAAiBiD,YAAjB,GAAgC,UAAUE,WAAV,EAAuB;AACrD,MAAIxB,IAAI,GAAGwB,WAAW,CAAC3C,KAAvB;;AACA,MAAI,KAAKL,IAAL,CAAU,GAAV,CAAJ,EAAoB;AAClB,SAAKM,OAAL;AACA,QAAI2C,MAAM,GAAG,EAAb;;AACA,WAAO,CAAC,KAAKjD,IAAL,CAAU,GAAV,CAAD,IAAmB,CAAC,KAAKW,KAAL,EAA3B,EAAyC;AACvCsC,MAAAA,MAAM,CAAC9B,IAAP,CAAY,KAAKC,UAAL,EAAZ;;AACA,UAAI,KAAKpB,IAAL,CAAU,GAAV,CAAJ,EAAoB;AAClB,aAAKM,OAAL;AACD;AACF;;AACD,SAAKG,MAAL,CAAY,GAAZ;AACA,WAAO,IAAIpB,YAAJ,CAAiBmC,IAAjB,EAAuByB,MAAvB,CAAP;AACD;;AACD,SAAO,IAAI7D,UAAJ,CAAeoC,IAAf,CAAP;AACD,CAfD;;AAiBA9B,MAAM,CAACG,SAAP,CAAiBkD,MAAjB,GAA0B,YAAY;AACpC,MAAI,KAAKjD,OAAL,GAAec,IAAf,KAAwB9B,SAAS,CAACoE,MAAtC,EAA8C;AAC5C,WAAO,IAAIjE,YAAJ,CAAiB,KAAKqB,OAAL,GAAeD,KAAhC,EAAuC,QAAvC,CAAP;AACD;;AACD,SAAO,KAAK8C,KAAL,EAAP;AACD,CALD;;AAOAzD,MAAM,CAACG,SAAP,CAAiBsD,KAAjB,GAAyB,YAAY;AACnC,MAAI,KAAKnD,IAAL,CAAU,GAAV,CAAJ,EAAoB;AAClB,SAAKM,OAAL;AACA,QAAI2C,MAAM,GAAG,EAAb;;AACA,WAAO,CAAC,KAAKjD,IAAL,CAAU,GAAV,CAAD,IAAmB,CAAC,KAAKW,KAAL,EAA3B,EAAyC;AACvCsC,MAAAA,MAAM,CAAC9B,IAAP,CAAY,KAAKC,UAAL,EAAZ;;AACA,UAAI,KAAKpB,IAAL,CAAU,GAAV,CAAJ,EAAoB;AAClB,aAAKM,OAAL;AACD;AACF;;AACD,SAAKG,MAAL,CAAY,GAAZ;AACA,WAAO,IAAInB,SAAJ,CAAc2D,MAAd,CAAP;AACD;;AACD,SAAO,KAAKG,MAAL,EAAP;AACD,CAdD;;AAgBA1D,MAAM,CAACG,SAAP,CAAiBuD,MAAjB,GAA0B,YAAY;AACpC,MAAIC,KAAK,GAAG,KAAKvD,OAAL,EAAZ;;AACA,MAAIuD,KAAK,CAACzC,IAAN,KAAe9B,SAAS,CAAC2D,MAA7B,EAAqC;AACnC,WAAO,IAAIxD,YAAJ,CAAiB,KAAKqB,OAAL,GAAeD,KAAhC,EAAuC,QAAvC,CAAP;AACD;;AACD,SAAO,KAAKiD,WAAL,EAAP;AACD,CAND;;AAQA5D,MAAM,CAACG,SAAP,CAAiByD,WAAjB,GAA+B,YAAY;AACzC,MAAID,KAAK,GAAG,KAAKvD,OAAL,EAAZ;;AACA,MAAIuD,KAAK,CAAChD,KAAN,KAAgB,GAApB,EAAyB;AACvB,SAAKC,OAAL;AACA,QAAIgB,IAAI,GAAG,KAAKF,UAAL,EAAX;AACA,SAAKX,MAAL,CAAY,GAAZ;AACA,WAAOa,IAAP;AACD;;AACD,SAAO,KAAKD,GAAL,EAAP;AACD,CATD;;AAWA3B,MAAM,CAACG,SAAP,CAAiBwB,GAAjB,GAAuB,YAAY;AACjC,MAAIgC,KAAK,GAAG,KAAKvD,OAAL,EAAZ;;AACA,MAAIuD,KAAK,CAACzC,IAAN,KAAe9B,SAAS,CAAC+B,GAA7B,EAAkC;AAChC,UAAMH,KAAK,CAAC,8BAAD,CAAX;AACD;AACF,CALD;;AAOA6C,MAAM,CAACC,OAAP,GAAiB9D,MAAjB","sourcesContent":["var tokenType = require('./token-type')\n\nvar Lexer = require('./Lexer')\nvar ConstantNode = require('./node/ConstantNode')\nvar OperatorNode = require('./node/OperatorNode')\nvar UnaryNode = require('./node/UnaryNode')\nvar SymbolNode = require('./node/SymbolNode')\nvar FunctionNode = require('./node/FunctionNode')\nvar ArrayNode = require('./node/ArrayNode')\nvar ConditionalNode = require('./node/ConditionalNode')\nvar AssignmentNode = require('./node/AssignmentNode')\nvar BlockNode = require('./node/BlockNode')\n\n/**\n * Grammar DSL:\n *\n * program          : block (; block)*\n *\n * block            : assignment\n *\n * assignment       : ternary\n *                  | symbol `=` assignment\n *\n * ternary          : logicalOR\n *                  | logicalOR `?` ternary `:` ternary\n *\n * logicalOR        : logicalXOR\n *                  | logicalXOR (`||`,`or`) logicalOR\n *\n * logicalXOR       : logicalAND\n *                  : logicalAND `xor` logicalXOR\n *\n * logicalAND       : bitwiseOR\n *                  | bitwiseOR (`&&`,`and`) logicalAND\n *\n * bitwiseOR        : bitwiseXOR\n *                  | bitwiseXOR `|` bitwiseOR\n *\n * bitwiseXOR       : bitwiseAND\n *                  | bitwiseAND `^|` bitwiseXOR\n *\n * bitwiseAND       : relational\n *                  | relational `&` bitwiseAND\n *\n * relational       : shift\n *                  | shift (`!=` | `==` | `>` | '<' | '<=' |'>=') shift)\n *\n * shift            : additive\n *                  | additive (`>>` | `<<` | `>>>`) shift\n *\n * additive         : multiplicative\n *                  | multiplicative (`+` | `-`) additive\n *\n * multiplicative   : unary\n *                  | unary (`*` | `/` | `%`) unary\n *                  | unary symbol\n *\n * unary            : pow\n *                  | (`-` | `+` | `~`) unary\n *\n * pow              : factorial\n *                  | factorial (`^`, '**') unary\n *\n * factorial        : symbol\n *                  | symbol (`!`)\n *\n * symbol           : symbolToken\n *                  | symbolToken functionCall\n *                  | string\n *\n * functionCall     : `(` `)`\n *                  | `(` ternary (, ternary)* `)`\n *\n * string           : `'` (character)* `'`\n *                  : `\"` (character)* `\"`\n *                  | array\n *\n * array            : `[` `]`\n *                  | `[` assignment (, assignment)* `]`\n *                  | number\n *\n * number           : number-token\n *                  | parentheses\n *\n * parentheses      : `(` assignment `)`\n *                  : end\n *\n * end              : NULL\n *\n * @param {[type]} lexer [description]\n */\nfunction Parser () {\n  this.lexer = new Lexer()\n  this.tokens = null\n}\n\nParser.prototype.current = function () {\n  return this.tokens[0]\n}\n\nParser.prototype.next = function () {\n  return this.tokens[1]\n}\n\nParser.prototype.peek = function () {\n  if (this.tokens.length) {\n    var first = this.tokens[0]\n    for (var i = 0; i < arguments.length; i += 1) {\n      if (first.value === arguments[i]) {\n        return true\n      }\n    }\n  }\n}\n\nParser.prototype.consume = function (e) {\n  return this.tokens.shift()\n}\n\nParser.prototype.expect = function (e) {\n  if (!this.peek(e)) {\n    throw Error('expected ' + e)\n  }\n  return this.consume()\n}\n\nParser.prototype.isEOF = function () {\n  return this.current().type === tokenType.EOF\n}\n\nParser.prototype.parse = function (text) {\n  this.tokens = this.lexer.lex(text)\n  return this.program()\n}\n\nParser.prototype.program = function () {\n  var blocks = []\n  while (!this.isEOF()) {\n    blocks.push(this.assignment())\n    if (this.peek(';')) {\n      this.consume()\n    }\n  }\n  this.end()\n  return new BlockNode(blocks)\n}\n\nParser.prototype.assignment = function () {\n  var left = this.ternary()\n  if (left instanceof SymbolNode && this.peek('=')) {\n    this.consume()\n    return new AssignmentNode(left.name, this.assignment())\n  }\n  return left\n}\n\nParser.prototype.ternary = function () {\n  var predicate = this.logicalOR()\n  if (this.peek('?')) {\n    this.consume()\n    var truthy = this.ternary()\n    this.expect(':')\n    var falsy = this.ternary()\n    return new ConditionalNode(predicate, truthy, falsy)\n  }\n  return predicate\n}\n\nParser.prototype.logicalOR = function () {\n  var left = this.logicalXOR()\n  if (this.peek('||')) {\n    var op = this.consume()\n    var right = this.logicalOR()\n    return new OperatorNode(op.value, [left, right])\n  }\n  return left\n}\n\nParser.prototype.logicalXOR = function () {\n  var left = this.logicalAND()\n  if (this.current().value === 'xor') {\n    var op = this.consume()\n    var right = this.logicalXOR()\n    return new OperatorNode(op.value, [left, right])\n  }\n  return left\n}\n\nParser.prototype.logicalAND = function () {\n  var left = this.bitwiseOR()\n  if (this.peek('&&')) {\n    var op = this.consume()\n    var right = this.logicalAND()\n    return new OperatorNode(op.value, [left, right])\n  }\n  return left\n}\n\nParser.prototype.bitwiseOR = function () {\n  var left = this.bitwiseXOR()\n  if (this.peek('|')) {\n    var op = this.consume()\n    var right = this.bitwiseOR()\n    return new OperatorNode(op.value, [left, right])\n  }\n  return left\n}\n\nParser.prototype.bitwiseXOR = function () {\n  var left = this.bitwiseAND()\n  if (this.peek('^|')) {\n    var op = this.consume()\n    var right = this.bitwiseXOR()\n    return new OperatorNode(op.value, [left, right])\n  }\n  return left\n}\n\nParser.prototype.bitwiseAND = function () {\n  var left = this.relational()\n  if (this.peek('&')) {\n    var op = this.consume()\n    var right = this.bitwiseAND()\n    return new OperatorNode(op.value, [left, right])\n  }\n  return left\n}\n\nParser.prototype.relational = function () {\n  var left = this.shift()\n  if (this.peek('==', '===', '!=', '!==', '>=', '<=', '>', '<')) {\n    var op = this.consume()\n    var right = this.shift()\n    return new OperatorNode(op.value, [left, right])\n  }\n  return left\n}\n\nParser.prototype.shift = function () {\n  var left = this.additive()\n  if (this.peek('>>', '<<', '>>>')) {\n    var op = this.consume()\n    var right = this.shift()\n    return new OperatorNode(op.value, [left, right])\n  }\n  return left\n}\n\nParser.prototype.additive = function () {\n  var left = this.multiplicative()\n  while (this.peek('+', '-')) {\n    var op = this.consume()\n    left = new OperatorNode(op.value, [left, this.multiplicative()])\n  }\n  return left\n}\n\nParser.prototype.multiplicative = function () {\n  var op, right\n  var left = this.unary()\n  while (this.peek('*', '/', '%')) {\n    op = this.consume()\n    left = new OperatorNode(op.value, [left, this.unary()])\n  }\n\n  // implicit multiplication\n  // - 2 x\n  // - 2(x)\n  // - (2)2\n  if (this.current().type === tokenType.SYMBOL ||\n      this.peek('(') ||\n      (!(left.type instanceof ConstantNode) && this.current().type === tokenType.NUMBER)\n      ) {\n    right = this.multiplicative()\n    return new OperatorNode('*', [left, right])\n  }\n\n  return left\n}\n\nParser.prototype.unary = function () {\n  if (this.peek('-', '+', '~')) {\n    var op = this.consume()\n    var right = this.unary()\n    return new UnaryNode(op.value, right)\n  }\n  return this.pow()\n}\n\nParser.prototype.pow = function () {\n  var left = this.factorial()\n  if (this.peek('^', '**')) {\n    var op = this.consume()\n    var right = this.unary()\n    return new OperatorNode(op.value, [left, right])\n  }\n  return left\n}\n\nParser.prototype.factorial = function () {\n  var left = this.symbol()\n  if (this.peek('!')) {\n    var op = this.consume()\n    return new OperatorNode(op.value, [left])\n  }\n  return left\n}\n\nParser.prototype.symbol = function () {\n  var current = this.current()\n  if (current.type === tokenType.SYMBOL) {\n    var symbol = this.consume()\n    var node = this.functionCall(symbol)\n    return node\n  }\n  return this.string()\n}\n\nParser.prototype.functionCall = function (symbolToken) {\n  var name = symbolToken.value\n  if (this.peek('(')) {\n    this.consume()\n    var params = []\n    while (!this.peek(')') && !this.isEOF()) {\n      params.push(this.assignment())\n      if (this.peek(',')) {\n        this.consume()\n      }\n    }\n    this.expect(')')\n    return new FunctionNode(name, params)\n  }\n  return new SymbolNode(name)\n}\n\nParser.prototype.string = function () {\n  if (this.current().type === tokenType.STRING) {\n    return new ConstantNode(this.consume().value, 'string')\n  }\n  return this.array()\n}\n\nParser.prototype.array = function () {\n  if (this.peek('[')) {\n    this.consume()\n    var params = []\n    while (!this.peek(']') && !this.isEOF()) {\n      params.push(this.assignment())\n      if (this.peek(',')) {\n        this.consume()\n      }\n    }\n    this.expect(']')\n    return new ArrayNode(params)\n  }\n  return this.number()\n}\n\nParser.prototype.number = function () {\n  var token = this.current()\n  if (token.type === tokenType.NUMBER) {\n    return new ConstantNode(this.consume().value, 'number')\n  }\n  return this.parentheses()\n}\n\nParser.prototype.parentheses = function () {\n  var token = this.current()\n  if (token.value === '(') {\n    this.consume()\n    var left = this.assignment()\n    this.expect(')')\n    return left\n  }\n  return this.end()\n}\n\nParser.prototype.end = function () {\n  var token = this.current()\n  if (token.type !== tokenType.EOF) {\n    throw Error('unexpected end of expression')\n  }\n}\n\nmodule.exports = Parser\n"]},"metadata":{},"sourceType":"script"}