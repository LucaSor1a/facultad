{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar d3_selection_1 = require(\"d3-selection\");\n\nvar evaluate_1 = __importDefault(require(\"../evaluate\"));\n\nvar utils_1 = __importDefault(require(\"../utils\"));\n\nfunction interval(chart) {\n  var minWidthHeight;\n  var xScale = chart.meta.xScale;\n  var yScale = chart.meta.yScale;\n\n  function clampRange(vLo, vHi, gLo, gHi) {\n    // issue 69\n    // by adding the option `invert` to both the xAxis and the `yAxis`\n    // it might be possible that after the transformation to canvas space\n    // the y limits of the rectangle get inverted i.e. gLo > gHi\n    //\n    // e.g.\n    //\n    //   functionPlot({\n    //     target: '#playground',\n    //     yAxis: { invert: true },\n    //     // ...\n    //   })\n    //\n    if (gLo > gHi) {\n      var t = gLo;\n      gLo = gHi;\n      gHi = t;\n    }\n\n    var hi = Math.min(vHi, gHi);\n    var lo = Math.max(vLo, gLo);\n\n    if (lo > hi) {\n      // no overlap\n      return [-minWidthHeight, 0];\n    }\n\n    return [lo, hi];\n  }\n\n  var line = function line(points, closed) {\n    var path = '';\n    var range = yScale.range();\n    var minY = Math.min.apply(Math, range);\n    var maxY = Math.max.apply(Math, range);\n\n    for (var i = 0, length = points.length; i < length; i += 1) {\n      if (points[i]) {\n        var x = points[i][0];\n        var y = points[i][1];\n        var yLo = y.lo;\n        var yHi = y.hi; // if options.closed is set to true then one of the bounds must be zero\n\n        if (closed) {\n          yLo = Math.min(yLo, 0);\n          yHi = Math.max(yHi, 0);\n        } // points.scaledDX is added because of the stroke-width\n\n\n        var moveX = xScale(x.lo) + points.scaledDx / 2;\n        var viewportY = clampRange(minY, maxY, isFinite(yHi) ? yScale(yHi) : -Infinity, isFinite(yLo) ? yScale(yLo) : Infinity);\n        var vLo = viewportY[0];\n        var vHi = viewportY[1];\n        path += ' M ' + moveX + ' ' + vLo;\n        path += ' v ' + Math.max(vHi - vLo, minWidthHeight);\n      }\n    }\n\n    return path;\n  };\n\n  function plotLine(selection) {\n    selection.each(function (d) {\n      var el = plotLine.el = d3_selection_1.select(this);\n      var index = d.index;\n      var closed = d.closed;\n      var evaluatedData = evaluate_1.default(chart, d);\n      var innerSelection = el.selectAll(':scope > path.line').data(evaluatedData); // the min height/width of the rects drawn by the path generator\n\n      minWidthHeight = Math.max(evaluatedData[0].scaledDx, 1);\n      var innerSelectionEnter = innerSelection.enter().append('path').attr('class', 'line line-' + index).attr('fill', 'none'); // enter + update\n\n      var selection = innerSelection.merge(innerSelectionEnter).attr('stroke-width', minWidthHeight).attr('stroke', utils_1.default.color(d, index)).attr('opacity', closed ? 0.5 : 1).attr('d', function (d) {\n        return line(d, closed);\n      });\n\n      if (d.attr) {\n        for (var k in d.attr) {\n          if (d.attr.hasOwnProperty(k)) {\n            selection.attr(k, d.attr[k]);\n          }\n        }\n      }\n\n      innerSelection.exit().remove();\n    });\n  }\n\n  return plotLine;\n}\n\nexports.default = interval;","map":{"version":3,"mappings":"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","names":["interval","chart","minWidthHeight","xScale","meta","yScale","clampRange","vLo","vHi","gLo","gHi","t","hi","Math","min","lo","max","line","points","closed","path","range","minY","apply","maxY","i","length","x","y","yLo","yHi","moveX","scaledDx","viewportY","isFinite","Infinity","plotLine","selection","each","d","el","d3_selection_1","index","evaluatedData","evaluate_1","innerSelection","selectAll","data","innerSelectionEnter","enter","append","attr","merge","utils_1","color","k","hasOwnProperty","exit","remove","exports"],"sourceRoot":"","sources":["../../src/graph-types/interval.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}